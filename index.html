<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>testoo</title>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background-color: #000;
      color: gold;
      font-family: 'Courier New', monospace;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    
#pageOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  backdrop-filter: blur(12px);
  background-color: rgba(0, 0, 0, 0.6);
  z-index: 9999;
  opacity: 1;
  transition: opacity 3s ease;
}
#pageOverlay.fade-out { opacity: 0; pointer-events: none; }

#particles-js { position: fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events:none; }

#viewersCount {
  position: fixed; top: 15px; left: 50%; transform: translateX(-50%);
  font-size: 24px; font-weight: bold; color: gold; z-index:10000;
  user-select: none; background: rgba(0,0,0,0.5); padding: 6px 12px;
  border-radius: 12px; box-shadow: 0 0 8px gold;
}

#chatWrapper {
  width: 96%; max-width:700px; max-height:66vh;
  background: rgba(0,0,0,0.6); backdrop-filter: blur(8px);
  border-radius: 12px; padding: 20px; box-sizing: border-box;
  position: fixed; bottom: 20px; left:50%; transform: translateX(-50%);
  z-index:10; display: flex; flex-direction: column;
}

#messages {
  flex:1; overflow-y:auto; padding:20px; border:1px solid #00ffcc;
  border-radius:8px; word-wrap: break-word; display:block;
  backdrop-filter: blur(6px); margin-bottom:10px;
  max-height:55vh; color:#00ffcc; font-size:16px; text-align:left;
}

#inputBar { display:none; gap:10px; margin-top:10px; align-items:center; }
#inputBar input { flex-grow:1; padding:10px; font-size:19px; border-radius:6px; border:1px solid #00ffcc; background:#111; color:gold; font-family:'Courier New', monospace; }
#inputBar button { padding:10px 20px; font-size:19px; border-radius:6px; border:2px solid gold; background:transparent; color:gold; cursor:pointer; font-weight:bold; transition: background-color 0.3s ease; }
#inputBar button:hover { background-color: gold; color:black; }

#clearChatBtn { background:red; color:white; display:none; margin-top:8px; padding:8px 16px; border:none; border-radius:6px; cursor:pointer; }

  </style>
</head>
<body>
  <div id="pageOverlay"></div>
  <div id="particles-js"></div>
  <div id="viewersCount">üëÅÔ∏è‚Äçüó®Ô∏è </div>

<div id="chatWrapper">
  <div id="messages"></div>

  <div id="inputBar">
    <input id="input" placeholder="Type a message..." autocomplete="off" />
    <button id="sendButton">Send</button>
  </div>

  <button id="clearChatBtn">Clear Chat</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded, onValue, set, onDisconnect, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBUb10JpH6iTD1sqSN7xz_lYDZUNSVennQ",
  authDomain: "testing-9b30c.firebaseapp.com",
  databaseURL: "https://testing-9b30c-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "testing-9b30c",
  storageBucket: "testing-9b30c.appspot.com",
  messagingSenderId: "569390736740",
  appId: "1:569390736740:web:4f017178b0b3df5ef28671"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const chatRef = ref(db, "chat");
const viewersRef = ref(db, "viewers");

const messagesDiv = document.getElementById("messages");
const input = document.getElementById("input");
const sendButton = document.getElementById("sendButton");
const inputBar = document.getElementById("inputBar");
const viewersCountDiv = document.getElementById("viewersCount");
const clearChatBtn = document.getElementById("clearChatBtn");

// Set visitor
let visitorId = Math.random().toString(36).substring(2,10);
let visitorRef = ref(db, "viewers/" + visitorId);
let userName = "";

// ŸÜÿ™ÿ≠ŸÇŸÇ ÿ•ÿ∞ÿß ŸÉÿßŸÜ A0Z
const savedUser = localStorage.getItem("userName");
if(savedUser==="A0Z"){
  userName="A0Z";
  inputBar.style.display="flex";
  clearChatBtn.style.display="inline-block";
  set(visitorRef, {active:true, name:"Only brother"});
} else {
  userName="";
  inputBar.style.display="none";
  clearChatBtn.style.display="none";
  set(visitorRef, {active:true, name:"Guest"});
}

onDisconnect(visitorRef).remove();

// ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿßÿØ ÿßŸÑŸÖÿ¥ÿßŸáÿØŸäŸÜ
onValue(viewersRef, snapshot=>{
  const viewers = snapshot.val();
  const count = viewers ? Object.keys(viewers).length : 0;
  viewersCountDiv.textContent=`üëÅÔ∏è‚Äçüó®Ô∏è ${count}`;
});

// ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ÿ≥ÿßŸÑÿ© ŸÅŸÇÿ∑ ŸÑŸÄ A0Z
function sendMessage(){
  const text = input.value.trim();
  if(!text || userName!=="A0Z") return;
  push(chatRef, {user:"A0Z", text, timestamp: serverTimestamp()});
  input.value="";
}

sendButton.addEventListener("click", sendMessage);
input.addEventListener("keydown", e=>{ if(e.key==="Enter") sendMessage(); });

// ŸÖÿ≥ÿ≠ ÿßŸÑÿ¥ÿßÿ™ ŸÅŸÇÿ∑ ŸÑŸÄ A0Z
clearChatBtn.addEventListener("click", async ()=>{
  if(userName!=="A0Z") return;
  if(!confirm("Are you sure to clear chat?")) return;
  try{
    await set(chatRef, null);
    messagesDiv.innerHTML="";
    push(chatRef, {user:"System", text:"Chat cleared by Only brother", timestamp: serverTimestamp()});
  } catch(err){ alert("Error clearing chat: "+err.message);}
});

// ÿπÿ±ÿ∂ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ
onChildAdded(chatRef, snapshot=>{
  const msg = snapshot.val();
  if(!msg.text || !msg.user) return;
  const displayName = msg.user==="A0Z"?"Only brother":msg.user;
  const div = document.createElement("div");
  div.textContent=`${displayName}: ${msg.text}`;
  messagesDiv.appendChild(div);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
});
</script>

<script>
  particlesJS("particles-js",{
    particles:{number:{value:70,density:{enable:true,value_area:800}},
    color:{value:"#ff3333"},
    shape:{type:"circle",stroke:{width:0,color:"#000"},polygon:{nb_sides:5}},
    opacity:{value:0.5,random:true,anim:{enable:true,speed:1,opacity_min:0.1,sync:false}},
    size:{value:3,random:true,anim:{enable:false}},
    line_linked:{enable:true,distance:150,color:"#ff3333",opacity:0.3,width:1},
    move:{enable:true,speed:1,direction:"none",random:true,straight:false,out_mode:"out",bounce:false,attract:{enable:false}}},
    interactivity:{detect_on:"canvas",events:{onhover:{enable:true,mode:"grab"},onclick:{enable:true,mode:"push"},resize:true},
    modes:{grab:{distance:200,line_linked:{opacity:0.5}},bubble:{distance:200,size:6,duration:2,opacity:0.8},repulse:{distance:100},push:{particles_nb:4},remove:{particles_nb:2}}},
    retina_detect:true
  });
</script>

<script>
window.addEventListener('load',()=>{
  document.getElementById('pageOverlay').classList.add('fade-out');
});
</script>
</body>
</html>