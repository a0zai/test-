<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta charset="UTF-8">
<title>A∞Z | Test</title>
<style>
    body {
        background-color: black;
        color: #00ffcc;
        font-family: "Courier New", monospace;
        padding: 2em;
        overflow: hidden;
    }
    #output {
        opacity: 1;
        transition: opacity 2.5s ease;
    }
    .line {
        margin-bottom: 1em;
        opacity: 0;
        animation: fadeIn 1s forwards;
        text-shadow: 0 0 8px #00ffcc;
    }
    @keyframes fadeIn { to { opacity: 1; } }
</style>
</head>
<body>
<div id="output"></div>

<script>
function delayPrint(lines, delay = 1200, callback = null) {
    const container = document.getElementById("output");
    lines.forEach((line, index) => {
        setTimeout(() => {
            const div = document.createElement("div");
            div.className = "line";
            div.style.animationDelay = (index * 0.4) + "s";
            div.textContent = line;
            container.appendChild(div);

            // When finished
            if (index === lines.length - 1 && callback) {
                setTimeout(callback, 2000);
            }
        }, index * delay);
    });
}

fetch("https://api.ipify.org?format=json")
    .then(response => response.json())
    .then(data => {
        const ip = data.ip;
        const ua = navigator.userAgent;
        const width = window.screen.width;
        const height = window.screen.height;
        const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
        const sessionId = btoa(ip + ua).slice(0,16);

        const lines = [
            "[ A∞Z / RECOVERED NODE ]",
            "Origin: Unknown",
            "Status: Unsealed",
            "",
            ">>> Decrypting frozen message... stand by",
            "",
            "Sender: Only Brother",
            "To: Mamy",
            "",
            "“Mamy…",
            "Why didn’t you answer my calls…?",
            "",
            "Papi still hasn’t woken up.",
            "Before he slept he whispered:",
            "  ‘Your Dady will be late.’”",
            "",
            "Message Age: 12 years",
            "Delivery Status: FAILED",
            "Reason: No recipient detected.",
            "",
            "------------------------------------",
            "",
            "Session ID: " + sessionId,
            "Trace IP: " + ip,
            "Device: " + ua,
            "Screen: " + width + "x" + height,
            "Timezone: " + tz,
            "",
            "This message was never meant to reach you.",
            "But something forwarded it anyway.",
            "",
            "Connection will close...",
            "Layer shift in progress..."
        ];

        delayPrint(lines, 1100, () => {
            // Fade-out
            const out = document.getElementById("output");
            out.style.opacity = 0;

            // Redirect after fade
            setTimeout(() => {
                window.location.href = "index.html";
            }, 2500);
        });

    })
    .catch(() => {
        delayPrint([
            "[ A∞Z / FAILURE ]",
            "Cannot retrieve metadata.",
            "But something already recognized you.",
            "",
            "Closing connection..."
        ], 1200, () => {
            const out = document.getElementById("output");
            out.style.opacity = 0;

            setTimeout(() => {
                window.location.href = "index.html";
            }, 2500);
        });
    });
</script>

</body>
</html>